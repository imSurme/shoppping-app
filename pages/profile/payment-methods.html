<!DOCTYPE html>
<html class="light" lang="tr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <meta name="theme-color" content="#008080"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <title>Ã–deme YÃ¶ntemleri - Modern Shopping App</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#008080",
                        "primary-dark": "#006666",
                        "background-light": "#FFFFFF",
                        "background-dark": "#101922",
                        "card-background-light": "#F8F9FA",
                        "card-background-dark": "#1a242d",
                        "text-light": "#1F2937",
                        "text-dark": "#F9FAFB",
                        "text-muted-light": "#6B7280",
                        "text-muted-dark": "#9CA3AF",
                        "border-light": "#E5E7EB",
                        "border-dark": "#374151",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.75rem",
                        "lg": "1rem",
                        "xl": "1.25rem",
                        "full": "9999px"
                    },
                    boxShadow: {
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'soft-dark': '0 2px 15px -3px rgba(0, 0, 0, 0.3), 0 10px 20px -2px rgba(0, 0, 0, 0.2)',
                    }
                },
            },
        }
    </script>
    
    <style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
        
        body {
            min-height: 100vh;
            min-height: 100dvh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        .header-button {
            transition: all 0.2s ease-in-out;
        }
        
        .header-button:active {
            transform: scale(0.9);
        }
        
        .payment-card {
            transition: all 0.2s ease-in-out;
        }
        
        .payment-card:active {
            transform: scale(0.98);
        }
        
        .payment-card.selected {
            border-color: #008080;
            border-width: 2px;
            background-color: rgba(0, 128, 128, 0.05);
        }
        
        .add-button {
            transition: all 0.2s ease-in-out;
        }
        
        .add-button:active {
            transform: scale(0.98);
        }
        
        .bottom-nav {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            width: 100% !important;
            padding-bottom: env(safe-area-inset-bottom, 0px);
            box-sizing: border-box;
        }
        
        .safe-area-top {
            padding-top: env(safe-area-inset-top);
        }
        
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Modal animations */
        @keyframes slide-up {
            from { 
                transform: translateY(100%); 
                opacity: 0;
            }
            to { 
                transform: translateY(0); 
                opacity: 1;
            }
        }
        
        @keyframes slide-down {
            from { 
                transform: translateY(0); 
                opacity: 1;
            }
            to { 
                transform: translateY(100%); 
                opacity: 0;
            }
        }
        
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .animate-slide-up {
            animation: slide-up 0.3s ease-out forwards;
        }
        
        .animate-slide-down {
            animation: slide-down 0.3s ease-out forwards;
        }
        
        .modal-backdrop {
            animation: fade-in 0.3s ease-out;
        }
        
        /* BoÅŸ durum animasyonu (sepet ile aynÄ±) */
        .empty-state-icon {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        /* Modal content initial state */
        #addPaymentModal .absolute.bottom-0 {
            transform: translateY(100%);
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
        
        <!-- Header -->
        <header class="sticky top-0 z-20 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md safe-area-top">
            <div class="flex items-center p-4 pb-2 justify-between">
                <button class="header-button flex size-12 shrink-0 items-center justify-center rounded-full hover:bg-card-background-light dark:hover:bg-card-background-dark transition-colors" onclick="goBack()">
                    <span class="material-symbols-outlined text-2xl text-text-light dark:text-text-dark">arrow_back</span>
                </button>
                
                <h1 class="text-text-light dark:text-text-dark text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">Ã–deme YÃ¶ntemleri</h1>
                
                <div class="w-12"></div>
            </div>
        </header>

        <!-- Content -->
        <main class="flex-grow flex flex-col p-4 pb-24 min-h-0">
            <!-- Liste ve buton (kart varken gÃ¶rÃ¼nÃ¼r) -->
            <div id="paymentMethodsContent" class="flex flex-col gap-4">
                <div id="paymentMethodsList" class="flex flex-col gap-4 mb-4">
                    <!-- Payment cards will be dynamically inserted here -->
                </div>
                <button 
                    onclick="openAddPaymentModal()"
                    class="add-button w-full bg-primary text-white py-4 rounded-xl font-semibold text-base shadow-soft hover:bg-primary-dark flex items-center justify-center gap-2"
                >
                    <span class="material-symbols-outlined">add</span>
                    Yeni Kart Ekle
                </button>
            </div>

            <!-- BoÅŸ durum (sepet gibi ortada, animasyonlu) -->
            <div id="emptyPaymentState" class="hidden flex-1 flex flex-col bg-background-light dark:bg-background-dark items-center justify-center text-center p-4">
                <div class="flex flex-col items-center gap-6">
                    <span class="material-symbols-outlined text-8xl text-text-muted-light dark:text-text-muted-dark empty-state-icon">credit_card_off</span>
                    <h2 class="text-2xl font-bold text-text-light dark:text-text-dark">HenÃ¼z KayÄ±tlÄ± KartÄ±nÄ±z Yok</h2>
                    <p class="text-text-muted-light dark:text-text-muted-dark max-w-xs">Ã–deme iÅŸlemlerinizi hÄ±zlandÄ±rmak iÃ§in kart bilgilerinizi kaydedebilirsiniz.</p>
                    <button class="add-button flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-8 mt-4 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em]" onclick="openAddPaymentModal()">
                        <span class="truncate">Yeni Kart Ekle</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav fixed bottom-0 left-0 right-0 z-20 bg-background-light dark:bg-background-dark border-t border-border-light dark:border-border-dark">
            <div class="flex px-2 py-1">
                <a class="nav-item flex flex-1 flex-col items-center justify-center gap-1 text-text-muted-light dark:text-text-muted-dark py-2" href="../../index.html">
                    <span class="material-symbols-outlined text-2xl">home</span>
                    <p class="text-xs font-medium">Ana Sayfa</p>
                </a>
                <a class="nav-item flex flex-1 flex-col items-center justify-center gap-1 text-text-muted-light dark:text-text-muted-dark py-2 relative" href="../shopping-cart.html">
                    <span class="material-symbols-outlined text-2xl">shopping_cart</span>
                    <p class="text-xs font-medium">Sepet</p>
                    <span class="absolute -top-1 -right-1 bg-primary text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold cart-badge hidden">0</span>
                </a>
                <a class="nav-item flex flex-1 flex-col items-center justify-center gap-1 text-primary py-2" href="user-profile.html">
                    <span class="material-symbols-outlined text-2xl" style="font-variation-settings: 'FILL' 1;">person</span>
                    <p class="text-primary text-xs font-semibold">Profil</p>
                </a>
            </div>
        </nav>

        <!-- Add Payment Method Modal -->
        <div id="addPaymentModal" class="fixed inset-0 z-50 hidden">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm modal-backdrop" onclick="closeAddPaymentModal()"></div>
            
            <!-- Modal Content -->
            <div class="absolute bottom-0 left-0 right-0 bg-background-light dark:bg-background-dark rounded-t-3xl max-h-[90vh] overflow-hidden">
                <div class="sticky top-0 bg-background-light dark:bg-background-dark border-b border-border-light dark:border-border-dark p-4 flex items-center justify-between">
                    <h2 class="text-text-light dark:text-text-dark text-lg font-bold" id="paymentModalTitle">Yeni Kart Ekle</h2>
                    <button onclick="closeAddPaymentModal()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors">
                        <span class="material-symbols-outlined text-xl text-text-light dark:text-text-dark">close</span>
                    </button>
                </div>
                
                <div class="overflow-y-auto max-h-[calc(90vh-80px)]">
                    <form id="addPaymentForm" class="p-4 flex flex-col gap-4">
                    <input type="hidden" id="editPaymentId" />
                    
                    <div class="flex flex-col gap-2">
                        <label class="text-text-light dark:text-text-dark text-sm font-semibold">Kart NumarasÄ±</label>
                        <input type="text" id="cardNumber" maxlength="19" class="form-input w-full rounded-xl border border-border-light dark:border-border-dark bg-card-background-light dark:bg-card-background-dark px-4 py-3 text-text-light dark:text-text-dark placeholder-text-muted-light dark:placeholder-text-muted-dark focus:ring-2 focus:ring-primary" placeholder="1234 5678 9012 3456" required />
                    </div>
                    
                    <div class="flex flex-col gap-2">
                        <label class="text-text-light dark:text-text-dark text-sm font-semibold">Kart Ãœzerindeki Ä°sim</label>
                        <input type="text" id="cardName" class="form-input w-full rounded-xl border border-border-light dark:border-border-dark bg-card-background-light dark:bg-card-background-dark px-4 py-3 text-text-light dark:text-text-dark placeholder-text-muted-light dark:placeholder-text-muted-dark focus:ring-2 focus:ring-primary" placeholder="AYÅžE YILMAZ" required />
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex flex-col gap-2">
                            <label class="text-text-light dark:text-text-dark text-sm font-semibold">Son Kullanma</label>
                            <input type="text" id="expiryDate" maxlength="5" class="form-input w-full rounded-xl border border-border-light dark:border-border-dark bg-card-background-light dark:bg-card-background-dark px-4 py-3 text-text-light dark:text-text-dark placeholder-text-muted-light dark:placeholder-text-muted-dark focus:ring-2 focus:ring-primary" placeholder="MM/YY" required />
                        </div>
                        
                        <div class="flex flex-col gap-2">
                            <label class="text-text-light dark:text-text-dark text-sm font-semibold">CVV</label>
                            <input type="text" id="cvv" maxlength="3" class="form-input w-full rounded-xl border border-border-light dark:border-border-dark bg-card-background-light dark:bg-card-background-dark px-4 py-3 text-text-light dark:text-text-dark placeholder-text-muted-light dark:placeholder-text-muted-dark focus:ring-2 focus:ring-primary" placeholder="123" required />
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="isDefaultPayment" class="w-5 h-5 text-primary rounded" />
                        <label for="isDefaultPayment" class="text-text-light dark:text-text-dark text-sm">VarsayÄ±lan Ã¶deme yÃ¶ntemi olarak ayarla</label>
                    </div>
                    
                    <div class="flex gap-3 mt-2">
                        <button type="button" onclick="closeAddPaymentModal()" class="flex-1 py-3 rounded-xl border border-border-light dark:border-border-dark text-text-light dark:text-text-dark font-semibold hover:bg-card-background-light dark:hover:bg-card-background-dark transition-colors">Ä°ptal</button>
                        <button type="submit" class="flex-1 py-3 rounded-xl bg-primary text-white font-semibold hover:bg-primary-dark transition-colors">Kaydet</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <!-- Cart Manager -->
    <script src="../../js/cart-manager.js"></script>
    
    <!-- JavaScript -->
    <script>
        let paymentMethods = [];

        // Navigation
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'user-profile.html';
            }
        }

        // Load payment methods
        function loadPaymentMethods() {
            const saved = localStorage.getItem('paymentMethods');
            if (saved) {
                paymentMethods = JSON.parse(saved);
            } else {
                // Default payment method
                paymentMethods = [
                    {
                        id: 1,
                        cardNumber: '4532 1234 5678 9010',
                        cardName: 'AYÅžE YILMAZ',
                        expiryDate: '12/25',
                        cvv: '123',
                        cardType: 'visa',
                        isDefault: true
                    }
                ];
                savePaymentMethods();
            }
            renderPaymentMethods();
        }

        // Save payment methods
        function savePaymentMethods() {
            localStorage.setItem('paymentMethods', JSON.stringify(paymentMethods));
        }

        // Get card type from number
        function getCardType(number) {
            const num = number.replace(/\s/g, '');
            if (num.startsWith('4')) return 'visa';
            if (num.startsWith('5')) return 'mastercard';
            if (num.startsWith('3')) return 'amex';
            return 'credit_card';
        }

        // Format card number
        function formatCardNumber(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            const matches = v.match(/\d{4,16}/g);
            const match = matches && matches[0] || '';
            const parts = [];
            for (let i = 0, len = match.length; i < len; i += 4) {
                parts.push(match.substring(i, i + 4));
            }
            if (parts.length) {
                return parts.join(' ');
            } else {
                return v;
            }
        }

        // Format expiry date
        function formatExpiryDate(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            if (v.length >= 2) {
                return v.substring(0, 2) + '/' + v.substring(2, 4);
            }
            return v;
        }

        // Render payment methods
        function renderPaymentMethods() {
            const container = document.getElementById('paymentMethodsList');
            const methodsContent = document.getElementById('paymentMethodsContent');
            const emptyState = document.getElementById('emptyPaymentState');
            container.innerHTML = '';

            if (paymentMethods.length === 0) {
                if (methodsContent) methodsContent.classList.add('hidden');
                if (emptyState) emptyState.classList.remove('hidden');
                return;
            }

            if (methodsContent) methodsContent.classList.remove('hidden');
            if (emptyState) emptyState.classList.add('hidden');

            paymentMethods.forEach(payment => {
                const card = document.createElement('div');
                card.className = `payment-card bg-card-background-light dark:bg-card-background-dark rounded-xl p-4 shadow-soft border-2 ${payment.isDefault ? 'selected border-primary' : 'border-transparent'}`;
                
                const cardType = getCardType(payment.cardNumber);
                const cardIcon = cardType === 'visa' ? 'ðŸ’³' : cardType === 'mastercard' ? 'ðŸ’³' : 'ðŸ’³';
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="text-3xl">${cardIcon}</div>
                            <div>
                                <h3 class="text-text-light dark:text-text-dark font-semibold text-base">${payment.cardName}</h3>
                                <p class="text-text-muted-light dark:text-text-muted-dark text-sm">**** **** **** ${payment.cardNumber.slice(-4)}</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editPayment(${payment.id})" class="p-2 hover:bg-background-light dark:hover:bg-background-dark rounded-lg transition-colors">
                                <span class="material-symbols-outlined text-text-muted-light dark:text-text-muted-dark text-lg">edit</span>
                            </button>
                            <button onclick="deletePayment(${payment.id})" class="p-2 hover:bg-red-100 dark:hover:bg-red-500/20 rounded-lg transition-colors">
                                <span class="material-symbols-outlined text-red-500 text-lg">delete</span>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-text-muted-light dark:text-text-muted-dark text-xs">Son Kullanma</p>
                            <p class="text-text-light dark:text-text-dark text-sm font-medium">${payment.expiryDate}</p>
                        </div>
                        ${payment.isDefault ? '<span class="bg-primary text-white text-xs px-2 py-1 rounded-full">VarsayÄ±lan</span>' : '<button onclick="setDefaultPayment(${payment.id})" class="text-primary text-sm font-medium hover:underline">VarsayÄ±lan Yap</button>'}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Open add payment modal
        function openAddPaymentModal() {
            const modal = document.getElementById('addPaymentModal');
            const modalContent = modal.querySelector('.absolute.bottom-0');
            document.getElementById('paymentModalTitle').textContent = 'Yeni Kart Ekle';
            document.getElementById('addPaymentForm').reset();
            document.getElementById('editPaymentId').value = '';
            modal.classList.remove('hidden');
            // Trigger animation
            setTimeout(() => {
                modalContent.classList.add('animate-slide-up');
            }, 10);
        }

        // Close add payment modal
        function closeAddPaymentModal() {
            const modal = document.getElementById('addPaymentModal');
            const modalContent = modal.querySelector('.absolute.bottom-0');
            modalContent.classList.remove('animate-slide-up');
            modalContent.classList.add('animate-slide-down');
            setTimeout(() => {
                modal.classList.add('hidden');
                modalContent.classList.remove('animate-slide-down');
            }, 300);
        }

        // Edit payment
        function editPayment(id) {
            const payment = paymentMethods.find(p => p.id === id);
            if (payment) {
                document.getElementById('editPaymentId').value = payment.id;
                document.getElementById('cardNumber').value = payment.cardNumber;
                document.getElementById('cardName').value = payment.cardName;
                document.getElementById('expiryDate').value = payment.expiryDate;
                document.getElementById('cvv').value = payment.cvv;
                document.getElementById('isDefaultPayment').checked = payment.isDefault;
                document.getElementById('paymentModalTitle').textContent = 'KartÄ± DÃ¼zenle';
                
                const modal = document.getElementById('addPaymentModal');
                const modalContent = modal.querySelector('.absolute.bottom-0');
                modal.classList.remove('hidden');
                // Trigger animation
                setTimeout(() => {
                    modalContent.classList.add('animate-slide-up');
                }, 10);
            }
        }

        // Delete payment
        function deletePayment(id) {
            if (confirm('Bu kartÄ± silmek istediÄŸinizden emin misiniz?')) {
                paymentMethods = paymentMethods.filter(p => p.id !== id);
                savePaymentMethods();
                renderPaymentMethods();
                showMessage('Kart silindi!', 'success');
            }
        }

        // Set default payment
        function setDefaultPayment(id) {
            paymentMethods.forEach(p => {
                p.isDefault = p.id === id;
            });
            savePaymentMethods();
            renderPaymentMethods();
            showMessage('VarsayÄ±lan kart gÃ¼ncellendi!', 'success');
        }

        // Card number formatting
        document.addEventListener('DOMContentLoaded', function() {
            const cardNumberInput = document.getElementById('cardNumber');
            if (cardNumberInput) {
                cardNumberInput.addEventListener('input', function(e) {
                    e.target.value = formatCardNumber(e.target.value);
                });
            }

            const expiryInput = document.getElementById('expiryDate');
            if (expiryInput) {
                expiryInput.addEventListener('input', function(e) {
                    e.target.value = formatExpiryDate(e.target.value);
                });
            }

            const cvvInput = document.getElementById('cvv');
            if (cvvInput) {
                cvvInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                });
            }
        });

        // Form submission
        document.getElementById('addPaymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editPaymentId').value;
            const paymentData = {
                id: editId ? parseInt(editId) : Date.now(),
                cardNumber: document.getElementById('cardNumber').value,
                cardName: document.getElementById('cardName').value.toUpperCase(),
                expiryDate: document.getElementById('expiryDate').value,
                cvv: document.getElementById('cvv').value,
                cardType: getCardType(document.getElementById('cardNumber').value),
                isDefault: document.getElementById('isDefaultPayment').checked
            };

            if (editId) {
                // Update existing
                const index = paymentMethods.findIndex(p => p.id === parseInt(editId));
                if (index !== -1) {
                    paymentMethods[index] = paymentData;
                }
            } else {
                // Add new
                if (paymentData.isDefault) {
                    paymentMethods.forEach(p => p.isDefault = false);
                }
                paymentMethods.push(paymentData);
            }

            savePaymentMethods();
            renderPaymentMethods();
            closeAddPaymentModal();
            showMessage(editId ? 'Kart gÃ¼ncellendi!' : 'Kart eklendi!', 'success');
        });

        // Message function
        function showMessage(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-20 left-1/2 transform -translate-x-1/2 z-50 ${type === 'success' ? 'bg-primary' : 'bg-red-500'} text-white px-6 py-3 rounded-xl shadow-lg`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translate(-50%, -20px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Dark mode functionality
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const themeIcon = document.querySelector('[onclick="toggleDarkMode()"] .material-symbols-outlined');
            if (themeIcon) {
                if (document.documentElement.classList.contains('dark')) {
                    themeIcon.textContent = 'light_mode';
                } else {
                    themeIcon.textContent = 'dark_mode';
                }
            }
        }

        // Initialize
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            updateThemeIcon();
            loadPaymentMethods();
        });
    </script>
</body>
</html>
